$(document).ready(function(){getOrderInfo()});function getOrderInfo(){let oid=window.sessionStorage.getItem("oid");let jsonStr=JSON.stringify({oid:oid});$.ajax({url:"getShopInfo",type:"get",async:false,dataType:"json",success:function(a){$("#order-title").text(a[0]);$("#order-foot-address").text("地址："+a[1]);$("#order-foot-phone").text("电话："+a[2]+"、"+a[3])},error:function(a){alert("----ajax请求加载店铺信息出错！错误信息如下：----\n"+a.responseText)}});$.ajax({url:"getOrderByOid",type:"post",data:jsonStr,contentType:"application/json;charset=utf-8",async:true,dataType:"json",success:function(a){buildOrder(a)},error:function(a){alert("----ajax请求指定编号订单出错！错误信息如下：----\n"+a.responseText)}})}function buildOrder(a){if(isLoaded("order-detail-tbody")){$("#order-detail-tbody").remove()}let html="<tbody id='order-detail-tbody'>";let clist=a.clist.split("_");let plist=a.plist.split("_");$.each(clist,function(b,c){let no=b+1;let p=plist[b].replace(" ","");let equalArr=p.split("=");let left=equalArr[0];let right=equalArr[1];right=right.replace("（","").replace("）","");let leftArr=left.split("*");let rightArr=right.split("-");let oprice=leftArr[0];let discount=leftArr[1];let num=leftArr[2];let lprice=rightArr[0];let dprice=rightArr[1];html+="<tr> <td>"+no+"</td><td>"+c+"</td><td>"+num+"</td><td>"+oprice+"</td><td>"+discount+"</td><td>"+lprice+"</td><td>-"+dprice+"</td></tr>"});html+="<tr><td>优惠：</td><td colspan='6'>-"+a.tdisprice+"元</td></tr><tr><td>合计：</td><td colspan='6'>"+a.tprice+"元</td></tr>";$("#order-id").text("订单编号："+a.oid);$("#order-time").text("时间："+timestampToTime(a.time,0));$("#order-detail-table").append(html);window.print()};