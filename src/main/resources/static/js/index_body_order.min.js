function index_body_order_init(){registeListener()}function registeListener(){getAllOrders();getOrderByOid();getOrderByKeywords();getOrderByDay();getOrderByWeek();getOrderByMonth();getOrderByYear()}function getOrderByOid(){$("form#getOrderByInfo button:eq(0)").on("click",function(){a()});function a(){let oid=$("#oidInput").val();if(oid===""){alert("请输入编号进行查询");$("#oidInput").focus();return}let jsonStr=JSON.stringify({oid:oid});$.ajax({url:"getOrderByOid",type:"post",data:jsonStr,contentType:"application/json;charset=utf-8",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求指定编号订单出错！错误信息如下：----\n"+b.responseText)}})}}function getOrderByKeywords(){$("form#getOrderByInfo button:eq(1)").on("click",function(){a()});function a(){let keywords=$("#keywordsInput").val();if(keywords===""){alert("请输入关键字进行查询");$("#keywordsInput").focus();return}let jsonStr=JSON.stringify({keywords:keywords});$.ajax({url:"getOrderByKeywords",type:"post",data:jsonStr,contentType:"application/json;charset=utf-8",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求包含关键字订单出错！错误信息如下：----\n"+b.responseText)}})}}function getOrderByDay(){$("form#getOrderByTime button:eq(0)").on("click",function(){a()});function a(){let time=$("#timeInput").val();if(time===""){alert("请选择日期进行查询");$("#timeInput").focus();return}let date=new Date(time);date.setHours(0);date.setMinutes(0);date.setSeconds(0);let timestamp=date.getTime();let jsonStr=JSON.stringify({time:timestamp});$.ajax({url:"getOrderByDay",type:"post",data:jsonStr,contentType:"application/json;charset=utf-8",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求指定某天的订单出错！错误信息如下：----\n"+b.responseText)}})}}function getOrderByWeek(){$("form#getOrderByTime button:eq(1)").on("click",function(){a()});function a(){$.ajax({url:"getOrderByWeek",type:"get",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求最近一周的订单出错！错误信息如下：----\n"+b.responseText)}})}}function getOrderByMonth(){$("form#getOrderByTime button:eq(2)").on("click",function(){a()});function a(){$.ajax({url:"getOrderByMonth",type:"get",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求最近一月的订单出错！错误信息如下：----\n"+b.responseText)}})}}function getOrderByYear(){$("form#getOrderByTime button:eq(3)").on("click",function(){a()});function a(){$.ajax({url:"getOrderByYear",type:"get",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请本年订单出错！错误信息如下：----\n"+b.responseText)}})}}function getAllOrders(){a();$("form#getOrderByTime button:eq(4)").on("click",function(){a()});function a(){$.ajax({url:"getAllOrders",type:"get",async:true,dataType:"json",success:function(b){showOrders(b)},error:function(b){alert("----ajax请求所有订单出错！错误信息如下：----\n"+b.responseText)}})}}function showOrders(b){if(isLoaded("allOrders-tbody")){$("#allOrders-tbody").remove()}let html="<tbody id='allOrders-tbody'>";let tincome=0;if(b instanceof Array){$.each(b,function(c,d){html+=a(d);tincome+=parseFloat(d.income)})}else{if(b instanceof Object){html+=a(b);tincome+=parseFloat(b.income)}}$("#totalIncome").text("总收入："+tincome.toFixed(2)+"元");if(html==="<tbody id='allOrders-tbody'>"){$("#noOrderTip").show()}else{$("#noOrderTip").hide();$("#allOrders-table").append(html)}function a(c){let rowhtml="";let clist=c.clist.split("_");let plist=c.plist.split("_");rowhtml+="<tr> <td>"+c.oid+"</td><td>"+timestampToTime(c.time,0)+"</td><td><ul>";$.each(clist,function(d,e){rowhtml+="<li><dl><dt>"+e+"</dt><dd>小计："+plist[d]+"</dd></dl></li>"});rowhtml+="</ul></td><td>-"+c.tdisprice+"</td><td>"+c.tprice+"</td><td>"+c.income+"</td><td>"+c.mark+"</td><td class='operation'><button type='button' class='btn btn-primary btn-sm' onclick='porder(this)'>打印</button></td></tr>";return rowhtml}}function porder(a){let oid=$(a).parent().parent().children("td:eq(0)").text();saveData2Ses({oid:oid});window.open("porder","_blank")};